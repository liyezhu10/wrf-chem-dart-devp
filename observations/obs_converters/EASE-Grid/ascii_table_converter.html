<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
          "http://www.w3.org/TR/html4/strict.dtd">
<HTML>
<HEAD>
<TITLE>program ascii_table_converter</TITLE>
<link rel="stylesheet" type="text/css" href="../../doc/html/doc.css" />
<link href="../../doc/images/dart.ico" rel="shortcut icon" />
</HEAD>
<BODY>
<A NAME="TOP"></A>

<H1>PROGRAM <em class=program>ascii_table_converter</em></H1>

<table border=0 summary="" cellpadding=5>
<tr>
    <td valign=middle>
    <img src="../../doc/images/Dartboard7.png" alt="DART project logo" height=70 />
    </td>
    <td>
       <P>Jump to <a href="../../index.html">DART Documentation Main Index</a><br />
          <small><small>version information for this file: <br />
          <!-- version tag follows, do not edit -->
          $Id$</small></small>
       </P></td>
</tr>
</table>

<A HREF="#Namelist">NAMELIST</A> /
<A HREF="#DataSources">DATA SOURCES</A> /
<A HREF="#Programs">PROGRAMS</A> /
<A HREF="#Decisions">DECISIONS</A> /
<A HREF="#References">REFERENCES</A> /
<A HREF="#Errors">ERRORS</A> /
<A HREF="#FuturePlans">PLANS</A> / 
<A HREF="#Legalese">TERMS OF USE</A>

<H1>Overview</H1>

<H2>SMAP Level 2 Soil Moisture <br />
    to DART Observation Sequence Converter</H2>

<P>This routine is designed to convert the
<a href="http://nsidc.org/data/SPL2SMP/versions/4">SMAP</a>
(<strong>Soil Moisture Active Passive</strong>) soil moisture observations 
to a DART observation sequence. The data format is HDF5, which has been
problematic, so the pertinent part of the data file has been converted to
a simple ASCII table with the following columns:
</P>
<ol>
<li>timestamp</li>
<li>latitude</li>
<li>longitude</li>
<li>soil moisture observation</li>
<li>soil moisture observation error estimate</li>
<li>quality control flag</li>
</ol>

<P>
<a href="http://nsidc.org">NSIDC</a> produces AMSR-E gridded brightness 
temperature data by interpolating AMSR-E data (6.9 GHz, 10.7 GHz, 18.7 GHz, 
23.8 GHz, 36.5 GHz, and 89.0 GHz) to the output grids from swath space 
using an Inverse Distance Squared (ID2) method. AMSR-E/Aqua L2A Global 
Swath Spatially-Resampled Brightness Temperatures (AE_L2A) input source 
data are used.
<br />
<br />
These data are provided in three EASE-Grid projections (north and south 
Lambert azimuthal and global cylindrical) at 25 km resolution, and in 
one global cylindrical, equidistant latitude-longitude projection at 
0.25 degree (quarter-degree) resolution. For both data sets, spatial 
coverage is global, data are daily, and coverage begins 19 June 2002 
and ends 27 September 2011.
<br />
<br />
<strong>Important</strong>: <em class=program>ascii_table_converter</em> uses an
observation error standard deviation of 2 degrees K - about 1%. This is a total guess
and should be thoroughly explored. 
<br />
<br />
<strong>Important</strong>: <em class=program>ascii_table_converter</em> has only
been thoroughly tested with the hemispheric files - these files have names like<br />
<em class=file>ID2r3-AMSRE-NL2011270D.v03.23V</em>. 
<br />
<br />
<strong>Perhaps More Important</strong>: Just because you <em>can</em> convert these
files to observations does not mean you should USE ALL OF THEM.
There are serious questions about using such a high-density set
of potentially correlated observations in what are typically pretty 
low-resolution models.
</P>

<P>
The workflow is usually: 
</P>
<ol>
<li>download the data for the period in question 
    (<a href="#DataSources">see DATA SOURCES below</a>)
<li>build the DART executables with support for the Tb observations.
    This is done by running <em class=program>preprocess</em> with 
    <em class=file>obs_def_brightnessT_mod.f90</em> in the list of <em class=code>input_files</em>
    for <em class=code>preprocess_nml</em>.
<li>convert each data file individually using <em class=program>ascii_table_converter</em></li>
<li>combine or subset all output files for the region and timeframe of interest into one file 
    using <a href="../../obs_sequence/obs_sequence_tool.html ">obs_sequence_tool</a></li>
</ol>

<P>
For some models (CLM, for example), it is required to reorganize the observation sequence
files into a series of files that contains ONLY the observations for each assimilation.
This can be achieved with the <a href="../../models/clm/shell_scripts/makedaily.sh">makedaily.sh</a> script. Since there
are subtleties for each model, <em class=program>makedaily.sh</em> is generally found in the
<em class=file>shell_scripts</em> directory of the model.
</P>

<!--==================================================================-->
<!--=================== DESCRIPTION OF A NAMELIST  ===================-->
<!--==================================================================-->

<A NAME="Namelist"></A>
<HR>
<H2>NAMELIST</H2>
<P>
This namelist is read from the file <em class=file>input.nml</em>.
Namelists start with an ampersand
'&amp;' and terminate with a slash '/'.
Character strings that contain a '/' must be
enclosed in quotes to prevent them from
prematurely terminating the namelist.
</P>

<div class=namelist>
<pre>
&amp;ascii_table_converter_nml
   input_file_list     = 'file_list.txt'
   obs_out_file        = 'obs_seq.out'
   max_num_input_files = 10
   verbose             = .false.
   /
</pre>
</div>

<div>

<TABLE border=0 cellspacing=10 width=100% summary='ascii_table_converter namelist description'>
<THEAD align=left>
<TR><TH>Contents    </TH>
    <TH>Type        </TH>
    <TH>Description </TH></TR>
</THEAD>

<TBODY valign=top>
<TR><!--contents--><TD> input_file_list  </TD>
    <!--  type  --><TD> character(len=256) </TD>
    <!--descript--><TD>Name of the file containing the list of input data files.
            Each input data file name must be on a separate line. No blank lines
            are allowed. This may be a relative or absolute filename. </TD></TR>

<TR><!--contents--><TD> obs_out_file  </TD>
    <!--  type  --><TD> character(len=256) </TD>
    <!--descript--><TD>Name of the output observation sequence file.</TD></TR>

<TR><!--contents--><TD> max_num_input_files </TD>
    <!--  type  --><TD> integer </TD>
    <!--descript--><TD> The maximum number of filenames in <em class=code>input_file_list</em> 
            to convert. This should be a small number - converting all frequencies, all
            polarizations, both passes into one file is generally not a smart thing to do.
                </TD></TR>

<TR><!--contents--><TD> verbose   </TD>
    <!--  type  --><TD> logical   </TD>
    <!--descript--><TD>Print extra information during the <em class=program>ascii_table_converter</em> 
            execution.</TD></TR>

</TBODY>
</TABLE>

</div>

<!--==================================================================-->

<A NAME="DataSources"></A>
<HR />
<H2>DATA SOURCES</H2>

<P>
The AMSR-E/Aqua daily EASE-grid Tb data was acquired from 
<a href="http://nsidc.org/data/nsidc-0301.html">http://nsidc.org/data/nsidc-0301.html</a>
<br />
<br />
Data are provided via FTP. Brightness temperature data (in tenths of kelvins) 
are two-byte unsigned integers and time files are two-byte signed integers."
Data are 2-byte signed integers, little-endian byte-order, indicating time of 
data acquisition as minutes since midnight (0:00 UTC) of the date of the 
enclosing file. The values in the time files range from 0 to 1440, 
with the value -32768 indicating missing data.  See more at
<a href="http://nsidc.org/data/docs/daac/nsidc0301_amsre_gridded_tb.gd.html">
http://nsidc.org/data/docs/daac/nsidc0301_amsre_gridded_tb.gd.html</a>

<H3>Data Citation</H3>

<P>
The following example shows how to cite the use of this data set in a publication.
For more information, see the <a href="http://nsidc.org/about/use_copyright.html">Use and Copyright</a> 
web page.

<blockquote>
O'Neill, P. E., S. Chan, E. G. Njoku, T. Jackson, and R. Bindlish. 2016. SMAP L2 Radiometer Half-Orbit 36 km EASE-Grid Soil Moisture, Version 4. [Indicate subset used]. Boulder, Colorado USA. NASA National Snow and Ice Data Center Distributed Active Archive Center. doi: http://dx.doi.org/10.5067/XPJTJT812XFY. [Date Accessed].
</blockquote>
</P>

<!--==================================================================-->

<A NAME="Programs"></A>
<HR />
<H2>PROGRAMS</H2>
<P>
The <em class=file>ascii_table_converter.f90</em> file is the source
for the converter program.
<br />
To compile and test,
go into the work subdirectory and run the <em class=file>quickbuild.csh</em>
script to build the converter and a couple of general purpose utilities.
<a href="../../time_manager/advance_time.html">advance_time</a> helps 
with calendar and time computations, and the
<a href="../../obs_sequence/obs_sequence_tool.html">obs_sequence_tool</a>
manipulates DART observation files once they have been created.
</P>

<!--==================================================================-->

<A NAME="Decisions"></A>
<HR />
<H2>DECISIONS YOU MIGHT NEED TO MAKE</H2>

<P>
See the discussion in the
<a href="../observations.html#Decisions">observations introduction</a> 
page about what options are available for the things you need to
specify.  These include setting a time, specifying an expected error,
setting a location, and an observation type.
</P>

<!--==================================================================-->
<!-- Describe the bugs.                                               -->
<!--==================================================================-->

<A NAME="KnownBugs"></A>
<HR />
<H2>KNOWN BUGS</H2>
<P>
There are no known bugs, but you may get one of two possible errors.
Since the data files are distributed in little-endian binary format, an
attempt is made to ensure the data are being read correctly. Rudimentary
checks are made on the times in the *.TIM file to make sure they are in
an allowable range. If they are not - it is a fairly strong indication
that the endian-ness of the file is not being handled correctly. Each
compiler and hardware configuration has their own solution, so if you
generate this error, you will have to find your own solution.
</P>

<!--==================================================================-->
<!-- Describe Future Plans.                                           -->
<!--==================================================================-->

<A NAME="FuturePlans"></A>
<HR />
<H2>FUTURE PLANS</H2>
<P>
none
</P>

<!--==================================================================-->
<!-- Legalese & Metadata                                              -->
<!--==================================================================-->

<A NAME="Legalese"></A>
<HR />
<H2>Terms of Use</H2>

<P>
DART software - Copyright 2004 - 2013 UCAR.<br />
This open source software is provided by UCAR, "as is",<br />
without charge, subject to all terms of use at<br />
<a href="http://www.image.ucar.edu/DAReS/DART/DART_download">
http://www.image.ucar.edu/DAReS/DART/DART_download</a>
</P>

<TABLE border=0 cellpadding=0 width=100% summary="">
<TR><TD valign=top>Contact:       </TD><TD> Tim Hoar </TD></TR>
<TR><TD valign=top>Revision:      </TD><TD> $Revision$ </TD></TR>
<TR><TD valign=top>Source:        </TD><TD> $URL$ </TD></TR>
<TR><TD valign=top>Change Date:   </TD><TD> $Date$ </TD></TR>
<TR><TD valign=top>Change&nbsp;history:&nbsp;</TD><TD> try "svn&nbsp;log" or "svn&nbsp;diff" </TD></TR>
</TABLE>

<!--==================================================================-->

</BODY>
</HTML>
